<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
  <title>松村式ポモドーロ</title>
  <meta name="theme-color" content="#ffffff">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="icon-192.png">
  <link rel="stylesheet" href="style.css?v=28">
</head>
<body>

  <!-- セットアップ画面 -->
  <div id="screen-setup" class="screen active">
    <div class="setup-content">
      <h1 class="app-title">松村式<br>ポモドーロ</h1>
      <p class="app-subtitle">25分作業 / 5:30休憩 / 25分長休憩</p>
      <details class="rules-section">
        <summary class="rules-toggle">松村式ルール</summary>
        <div class="rules-content">
          <dl>
            <dt>基本サイクル</dt>
            <dd>25分作業 &rarr; 5:30休憩（&times;4、4回目は25分休憩）</dd>
            <dt>休憩ルール</dt>
            <dd>強制。スキップ・停止・解除 不可<br>受動的快楽か、何もしないこと</dd>
            <dt>作業中の禁止事項</dt>
            <dd>音楽・BGM / 動画 / SNS / メール / その他</dd>
            <dt>トイレ中断</dt>
            <dd>続きから再開（スマホ禁止）</dd>
            <dt>緊急中断（電話・来客等）</dt>
            <dd>0〜5分 &rarr; 休憩なしでやり直し<br>5〜20分 &rarr; 5:30休憩後やり直し<br>20分〜 &rarr; 続きから再開</dd>
            <dt>違反（禁止事項破り）</dt>
            <dd>ポモドーロ不成立（存在しない扱い）<br>3分間使用禁止</dd>
          </dl>
        </div>
      </details>
      <div class="set-selector">
        <div class="set-heading">セット数</div>
        <div class="set-options">
          <button class="set-btn selected" data-sets="1">1</button>
          <button class="set-btn" data-sets="2">2</button>
          <button class="set-btn" data-sets="3">3</button>
          <button class="set-btn" data-sets="4">4</button>
          <button class="set-btn" data-sets="0"><svg width="22" height="12" viewBox="0 0 24 12" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"><path d="M12,6 C12,1 6,-1 3,3 C0,7 3,13 6,11 C9,9 12,6 12,6 C12,6 15,3 18,1 C21,-1 24,5 21,9 C18,13 12,11 12,6"/></svg></button>
        </div>
      </div>
      <div class="theme-selector collapsed">
        <div class="selector-heading" id="theme-heading">デザイン：クリーン</div>
        <div class="theme-options">
          <button class="theme-btn selected" data-theme="clean">クリーン</button>
          <button class="theme-btn" data-theme="digital">デジタル</button>
          <button class="theme-btn" data-theme="neon">ネオン</button>
          <button class="theme-btn" data-theme="bold">ボールド</button>
          <button class="theme-btn" data-theme="gradient">グラデ</button>
        </div>
      </div>
      <div class="progress-selector collapsed">
        <div class="selector-heading" id="progress-heading">プログレス：フレーム</div>
        <div class="progress-options">
          <button class="progress-btn selected" data-progress="frame">フレーム</button>
          <button class="progress-btn" data-progress="bar">バー</button>
          <button class="progress-btn" data-progress="color">カラー</button>
          <button class="progress-btn" data-progress="blocks">ブロック</button>
          <button class="progress-btn" data-progress="hourglass">砂時計</button>
        </div>
      </div>
      <button id="btn-start" class="btn-primary">スタート</button>
    </div>
  </div>

  <!-- タイマー画面 -->
  <div id="screen-timer" class="screen">
    <div class="timer-content">
      <div id="state-label" class="state-label">作業中</div>
      <div id="cycle-label" class="cycle-label">サイクル 1 / 4</div>
      <div class="timer-frame-container" id="timer-frame-container">
        <svg class="timer-frame" viewBox="0 0 250 150">
          <rect class="timer-frame-bg" x="3" y="3" width="244" height="144" rx="16" pathLength="100" />
          <rect id="timer-frame-progress" class="timer-frame-progress" x="3" y="3" width="244" height="144" rx="16" pathLength="100" />
        </svg>
        <div id="timer-display" class="timer-display">25:00</div>
      </div>
      <div class="progress-bar-track">
        <div id="progress-bar-fill" class="progress-bar-fill"></div>
      </div>
      <div id="progress-blocks" class="progress-blocks"></div>
      <div class="progress-hourglass-container">
        <svg class="progress-hourglass-svg" viewBox="0 0 80 120">
          <defs>
            <clipPath id="hg-clip-top">
              <polygon points="10,5 70,5 44,52 36,52"/>
            </clipPath>
            <clipPath id="hg-clip-bottom">
              <polygon points="36,68 44,68 70,115 10,115"/>
            </clipPath>
          </defs>
          <rect id="hg-sand-top" clip-path="url(#hg-clip-top)" x="0" y="5" width="80" height="47" opacity="0.15"/>
          <rect id="hg-sand-bottom" clip-path="url(#hg-clip-bottom)" x="0" y="115" width="80" height="0" opacity="0.15"/>
          <path d="M10,5 L70,5 L44,52 L44,68 L70,115 L10,115 L36,68 L36,52 Z" fill="none" stroke-width="1.5" stroke-linejoin="round"/>
          <line id="hg-stream" x1="40" y1="56" x2="40" y2="64" stroke-width="1" opacity="0"/>
        </svg>
      </div>
      <button id="btn-focus-info" class="btn-focus-info">ℹ</button>
      <div id="cycle-dots" class="cycle-dots"></div>
      <div id="set-label" class="set-label-info">セット 1</div>
      <div id="break-reminder" class="break-reminder" hidden>受動的快楽か、何もしないこと</div>
      <div class="action-group">
        <button id="btn-toilet" class="btn-action btn-toilet" hidden>トイレ</button>
        <button id="btn-interrupt" class="btn-action btn-interrupt" hidden>緊急中断</button>
      </div>
      <div id="violation-row" class="violation-row" hidden>
        <button id="btn-violation" class="btn-action btn-violation">違反</button>
      </div>
      <button id="btn-stop" class="btn-stop" hidden>停止</button>
      <button id="btn-timer-end" class="btn-stop" hidden>セッションを終了</button>
    </div>
  </div>

  <!-- トイレ一時停止画面 -->
  <div id="screen-toilet" class="screen">
    <div class="center-content">
      <div class="state-label">一時停止中</div>
      <div class="pause-label">トイレ中断</div>
      <p class="pause-rule">トイレ以外は一切禁止<br>スマホ・SNS禁止</p>
      <button id="btn-resume" class="btn-primary">再開</button>
      <button id="btn-toilet-stop" class="btn-stop">セッションを終了</button>
    </div>
  </div>

  <!-- 外的中断画面 -->
  <div id="screen-interrupt" class="screen">
    <div class="center-content">
      <div class="state-label">中断中</div>
      <div id="interrupt-elapsed" class="interrupt-info">作業経過: 00:00</div>
      <div id="interrupt-action" class="interrupt-action"></div>
      <button id="btn-return" class="btn-primary">戻る</button>
      <button id="btn-interrupt-stop" class="btn-stop">セッションを終了</button>
    </div>
  </div>

  <!-- 使用禁止画面 -->
  <div id="screen-ban" class="screen">
    <div class="center-content">
      <div class="state-label state-ban">使用禁止</div>
      <div class="timer-frame-container">
        <svg class="timer-frame" viewBox="0 0 250 150">
          <rect class="timer-frame-bg" x="3" y="3" width="244" height="144" rx="16" pathLength="100" />
          <rect id="ban-frame-progress" class="timer-frame-progress" x="3" y="3" width="244" height="144" rx="16" pathLength="100" />
        </svg>
        <div id="ban-timer" class="timer-display timer-ban">3:00</div>
      </div>
      <div class="ban-message">内的中断 &#8212; ポモドーロ不成立</div>
      <button id="btn-ban-stop" class="btn-stop ban-stop-btn">セッションを終了</button>
    </div>
  </div>

  <!-- バン後の再開画面 -->
  <div id="screen-resume" class="screen">
    <div class="center-content">
      <div class="state-label">準備完了</div>
      <div id="resume-info" class="resume-info"></div>
      <button id="btn-resume-work" class="btn-primary">再開</button>
      <button id="btn-resume-stop" class="btn-stop">セッションを終了</button>
    </div>
  </div>

  <!-- 完了画面 -->
  <div id="screen-complete" class="screen">
    <div class="center-content">
      <div class="complete-check">&#10003;</div>
      <div class="complete-message">お疲れ様でした</div>
      <button id="btn-restart" class="btn-primary">もう一度</button>
    </div>
  </div>

  <!-- グラデーションテーマ用SVG定義 -->
  <svg style="position:absolute;width:0;height:0">
    <defs>
      <linearGradient id="gradient-work" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" stop-color="#667eea"/>
        <stop offset="100%" stop-color="#764ba2"/>
      </linearGradient>
      <linearGradient id="gradient-break" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" stop-color="#11998e"/>
        <stop offset="100%" stop-color="#38ef7d"/>
      </linearGradient>
      <linearGradient id="gradient-long" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" stop-color="#7c3aed"/>
        <stop offset="100%" stop-color="#c084fc"/>
      </linearGradient>
    </defs>
  </svg>

  <script src="app.js?v=28"></script>
</body>
</html>
